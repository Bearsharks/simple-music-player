(this["webpackJsonpsimple-music-player"]=this["webpackJsonpsimple-music-player"]||[]).push([[0],{21:function(e,t,i){e.exports={spinnerWrapper:"Spinner_spinnerWrapper__1sjWi",spinner:"Spinner_spinner__3jVAw",rotate:"Spinner_rotate__1hbt0"}},27:function(e,t,i){},28:function(e,t,i){},35:function(e,t,i){"use strict";i.r(t);var n=i(0),s=i.n(n),r=i(9),c=i.n(r),a=(i(27),i(3)),o=(i(28),i(21)),u=i.n(o),d=i(1);var l=function(){return Object(d.jsxs)("div",{className:u.a.spinnerWrapper,children:[Object(d.jsx)("div",{className:u.a.spinner,children:Object(d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"40px",viewBox:"0 0 24 24",width:"40px",fill:"#000000",children:[Object(d.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),Object(d.jsx)("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"})]})}),Object(d.jsx)("div",{children:"\ubd88\ub7ec\uc624\ub294 \uc911..."})]})},h=i(11),f=i(2),w=i(7),b=i(4),j={idx:-1,id:-1,key:-1},p="My playlist",g="curPlayListName",M=Object(w.b)({key:"musicListState",default:[]}),v=Object(w.b)({key:"curMusicIndexState",default:j.idx}),x=Object(w.c)({key:"curMusicInfoState",get:function(e){var t=e.get,i=t(M),n=t(v);return n===j.idx||0===i.length?j:Object(b.a)({idx:n},i[n])},set:function(e,t){var i=e.set,n=Object(a.a)(t,2),s=n[0],r=n[1];(0===s||s)&&i(v,s),r&&i(M,r)}}),y=i(5),O=i(8),m=function(){function e(){Object(y.a)(this,e),this._storage=new Map,this._storage_cnt=new Map,this.store=this.store.bind(this),this.delete=this.delete.bind(this),this.get=this.get.bind(this),this.set=this.set.bind(this)}return Object(O.a)(e,[{key:"get",value:function(e,t){if(!e)throw new Error("store state error : invalid key");t&&(e=t+"_"+e);var i=this._storage.get(e);return i||(0===(i=JSON.parse(localStorage.getItem(e)))||i?(this._storage.set(e,i),i):void 0)}},{key:"set",value:function(e,t,i){if(!e)throw new Error("store state error : invalid key");i&&(e=i+"_"+e),this._storage.set(e,t),localStorage.setItem(e,JSON.stringify(t)),this._storage_cnt.get(e)||this._storage_cnt.set(e,1)}},{key:"store",value:function(e,t){if(!e)throw new Error("store state error : invalid key");t&&(e=t+"_"+e);var i=this._storage_cnt.get(e);this._storage_cnt.set(e,i?i+1:1)}},{key:"delete",value:function(e,t){if(!e)throw new Error("store state error : invalid key");t&&(e=t+"_"+e);var i=this._storage_cnt.get(e);i>1?this._storage_cnt.set(e,i-1):1===i&&(this._storage_cnt.delete(e),this._storage.delete(e),localStorage.removeItem(e))}}]),e}();function I(){var e=Object(n.useState)([p]),t=Object(a.a)(e,2),i=t[0],s=t[1],r=Object(w.d)(x),c=Object(a.a)(r,2),o=(c[0],c[1]),u=Object(n.useRef)();Object(n.useEffect)((function(){window.storeManager||(window.storeManager=new m);var e=window.storeManager.get("playlists");e?s(e):window.storeManager.set("playlists",i)}),[]);var l=function(e){var t=window.storeManager.get(e,"list"),i=window.storeManager.get(e,"idx");o([i,t]),window.storeManager.set(g,e)};return Object(d.jsxs)("ul",{children:[Object(d.jsx)("button",{onClick:function(){var e=u.current.value;if(e){var t,n=Object(f.a)(i);try{for(n.s();!(t=n.n()).done;){if(t.value===e)return alert("\uc774\ubbf8 \uc874\uc7ac\ud558\ub294 \ud50c\ub808\uc774\ub9ac\uc2a4\ud2b8")}}catch(c){n.e(c)}finally{n.f()}var r=[].concat(Object(h.a)(i),[e]);window.storeManager.set(e,[],"list"),window.storeManager.set(e,j.id,"idx"),window.storeManager.set("playlists",r),s(r),u.current.value=""}},children:"\uc0c8\ub85c\uc6b4 \ud50c\ub808\uc774\ub9ac\uc2a4\ud2b8 \ub9cc\ub4e4\uae30"}),Object(d.jsx)("input",{ref:u,type:"text"}),i.map((function(e,t){return Object(d.jsxs)("li",{onClick:function(){l(e)},children:[e,e!==p&&Object(d.jsx)("button",{onClick:function(){!function(e){var t=window.storeManager.get(e,"list");window.storeManager.delete(e,"list"),window.storeManager.delete(e,"idx");var i,n=Object(f.a)(t);try{for(n.s();!(i=n.n()).done;){var s=i.value;window.storeManager.delete(s.q,"query")}}catch(r){n.e(r)}finally{n.f()}l(p)}(e)},children:"X"})]},e)}))]})}var k=i(14),L=0;function _(e){window.storeManager||(window.storeManager=new m);var t=window.storeManager.get(e,"list");if(0!==t.length){var i,n=Object(f.a)(t);try{for(n.s();!(i=n.n()).done;){var s=i.value;window.storeManager.store(s.q,"query")}}catch(r){n.e(r)}finally{n.f()}}}function C(e,t){var i=Object(w.d)(x),s=Object(a.a)(i,2),r=s[0],c=s[1],o=Object(n.useRef)(j);Object(n.useEffect)((function(){var e,t=function(){window.storeManager||(window.storeManager=new m);var e=window.storeManager.get("playlists");return e||(e=[p],window.storeManager.set("playlists",e)),e}(),i=Object(f.a)(t);try{for(i.s();!(e=i.n()).done;){_(e.value)}}catch(n){i.e(n)}finally{i.f()}!function(e){window.storeManager||(window.storeManager=new m);var t=window.storeManager.get(g);t||(t=p,window.storeManager.set(g,t));var i=window.storeManager.get(t,"idx"),n=window.storeManager.get(t,"list");0===i||i||(i=j.idx,window.storeManager.set(t,i,"idx")),n||(n=[],window.storeManager.set(t,n,"list")),e([i,n])}(c)}),[c]),Object(n.useEffect)((function(){if(r.key){var i=r.key===o.current.key,n=o.current.id===j.id&&r.id!==j.id,s=o.current.id===r.id;if(!i||!n&&!s){var c=window.storeManager.get(g);if(window.storeManager.set(c,r.idx,"idx"),r.key===j.key)t();else{var a=r;if(!r.id){var u=window.storeManager.get(r.q,"query");u&&(a=Object(b.a)(Object(b.a)({},a),{},{id:u[0].id.videoId}))}e(a)}o.current=r}}}),[r])}var q=function(){function e(t,i){Object(y.a)(this,e),this.musicList=t[0],this.setMusicList=t[1],this.curMusicIndex=i[0],this.setCurMusicIndex=i[1],window.storeManager||(window.storeManager=new m);var n=window.storeManager.get(g);this.curPlayListName=n||p,this.goNextMusic=this.goNextMusic.bind(this),this.goPrevMusic=this.goPrevMusic.bind(this),this.reorderMusicList=this.reorderMusicList.bind(this),this.deleteMusic=this.deleteMusic.bind(this),this.appendMusicList=this.appendMusicList.bind(this),this.modMusicList=this.modMusicList.bind(this),this.initMusicInfo=this.initMusicInfo.bind(this),this.updateMusicList=this.updateMusicList.bind(this),this.selectMusic=this.selectMusic.bind(this)}return Object(O.a)(e,[{key:"goNextMusic",value:function(){this.curMusicIndex+1<this.musicList.length&&this.setCurMusicIndex(this.curMusicIndex+1)}},{key:"goPrevMusic",value:function(){this.curMusicIndex-1>=0&&this.setCurMusicIndex(this.curMusicIndex-1)}},{key:"reorderMusicList",value:function(e,t){if(t!==e){var i=Array.from(this.musicList),n=i.splice(e,1),s=Object(a.a)(n,1)[0];i.splice(t,0,s),this.updateMusicList(i);var r=this.curMusicIndex===e,c=this.curMusicIndex>e&&this.curMusicIndex<=t,o=this.curMusicIndex<e&&this.curMusicIndex>=t;r?this.selectMusic(t):c?this.goPrevMusic():o&&this.goNextMusic()}}},{key:"deleteMusic",value:function(e){var t=Object(b.a)(Object(b.a)({},this.musicList[e]),{},{idx:e}),i=1===this.musicList.length;if(window.storeManager.delete(t.q,"query"),i)return this.updateMusicList([]),void this.setCurMusicIndex(j.idx);var n=t.idx===this.musicList.length-1,s=this.curMusicIndex>t.idx,r=this.curMusicIndex===t.idx,c=this.musicList.filter((function(e,i){return i!==t.idx}));this.updateMusicList(c),(r&&n||s)&&this.setCurMusicIndex(this.curMusicIndex-1)}},{key:"appendMusicList",value:function(e){if(!((e=e.filter((function(e){return""!==e}))).length<1)){var t,i=function(e){if(e){var t=Date.now();return new Array(e).fill(null).map((function(e,i){return t+"_"+L++}))}return Date.now()+"_"+L++}(e.length),n=e.map((function(e,t){return{q:e,id:null,key:i[t]}})),s=Object(f.a)(n);try{for(s.s();!(t=s.n()).done;){var r=t.value;window.storeManager.store(r.q,"query")}}catch(o){s.e(o)}finally{s.f()}var c=this.musicList.length,a=[].concat(Object(h.a)(this.musicList),Object(h.a)(n));this.updateMusicList(a),this.curMusicIndex===j.idx&&this.setCurMusicIndex(c)}}},{key:"updateMusicList",value:function(e){this.setMusicList(e),window.storeManager.set(this.curPlayListName,e,"list")}},{key:"modMusicList",value:function(e,t){var i=Object(b.a)(Object(b.a)({},this.musicList[e]),{},{id:t.id.videoId}),n=this.musicList.map((function(t,n){return e===n?i:t}));this.updateMusicList(n)}},{key:"initMusicInfo",value:function(e,t,i,n){n||(n=0),this.modMusicList(e,i[n]),window.storeManager.set(t,i,"query")}},{key:"selectMusic",value:function(e){this.setCurMusicIndex(e)}}]),e}(),S=i(6),N=i.n(S),E=i(12);function P(e){return R.apply(this,arguments)}function R(){return(R=Object(E.a)(N.a.mark((function e(t){var i,n,s,r,c;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={part:"snippet",maxResults:5,type:"video",topic:"/m/04rlf",q:"".concat(t," audio")},n=Object.keys(i).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(i[e])})).join("&"),"items(id,snippet(title,description,thumbnails))",s=window.youtubeKey,r="https://www.googleapis.com/youtube/v3/search?key=".concat(s,"&fields=").concat("items(id,snippet(title,description,thumbnails))","&").concat(n),e.next=7,fetch(r,{method:"GET"});case 7:if(200!==(c=e.sent).status){e.next=12;break}return e.abrupt("return",c.json());case 12:400===c.status&&alert("\uc798\ubabb\ub41c \ud0a4\uc774\uac70\ub098 \ud574\ub2f9\ud0a4\uc758 api \ud560\ub2f9\ub7c9\uc744 \ucd08\uacfc\ud588\uc2b5\ub2c8\ub2e4.");case 13:throw new Error("request fail");case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){var t=e.query,i=e.selectQuery,s=e.curItemId,r=(e.hide,Object(n.useState)(null)),c=Object(a.a)(r,2),o=c[0],u=c[1],l=Object(n.useState)(0),h=Object(a.a)(l,2),f=h[0],w=h[1];Object(n.useEffect)((function(){if(!o){var e=window.storeManager.get(t,"query");e?u(e):function(e){i.apply(this,arguments)}(t)}function i(){return(i=Object(E.a)(N.a.mark((function e(t){var i;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,P(t);case 3:i=e.sent,window.storeManager.set(t,i.items,"query"),u(i.items),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}}),[]),Object(n.useEffect)((function(){for(var e in o)if(o[e].id.videoId===s){w(parseInt(e));break}}),[o,s]);return Object(d.jsx)(d.Fragment,{children:o&&Object(d.jsx)("ul",{children:o.map((function(e,t){return Object(d.jsxs)("li",{onClick:function(e){return function(e,t){e.stopPropagation(),i(o[t])}(e,t)},style:f===t?{color:"blue"}:{},children:[Object(d.jsx)("img",{src:e.snippet.thumbnails.default.url,alt:e.snippet.title}),e.snippet.title]},e.id.videoId)}))})})}function B(e){var t=Object(n.useState)(!1),i=Object(a.a)(t,2),s=i[0],r=i[1];return Object(d.jsxs)("div",{children:[e.ele.q," ",Object(d.jsx)("button",{onClick:function(t){return function(t,i){t.stopPropagation(),t.preventDefault(),e.deleteMusic(i)}(t,e.index)},children:" X "}),Object(d.jsx)("button",{onClick:function(e){e.stopPropagation(),r(!s)},children:"\ud3bc\uce58\uae30 "}),s&&Object(d.jsx)(V,{query:e.ele.q,selectQuery:function(t){e.modMusicList(e.index,t)},curItemId:e.ele.id})]})}var A=Object(n.memo)((function(e){return Object(d.jsx)(k.b,{draggableId:e.ele.key,index:e.index,children:function(t,i){return Object(d.jsx)("li",Object(b.a)(Object(b.a)(Object(b.a)({ref:t.innerRef},t.draggableProps),t.dragHandleProps),{},{onClick:function(t){e.selectMusic(e.index)},children:Object(d.jsx)("div",{style:e.isCurMusic?{border:"1px solid black"}:{},children:Object(d.jsx)(B,{ele:e.ele,index:e.index,deleteMusic:e.deleteMusic,modMusicList:e.modMusicList})})}))}})}));function D(e){var t=Object(n.useState)(""),i=Object(a.a)(t,2),s=i[0],r=i[1],c=Object(w.d)(M),o=c[0],u=Object(w.d)(v),l=u[0],h=new q(c,u);C((function(e){window.player&&(e.id?window.player.loadVideoById({videoId:e.id}):P(e.q).then((function(t){var i=t.items[0].id.videoId;window.player.loadVideoById({videoId:i}),h.initMusicInfo(e.idx,e.q,t.items)})).catch((function(e){console.error(e)})))}),(function(){window.player&&window.player.stopVideo&&window.player.stopVideo()})),Object(n.useEffect)((function(){e.goNextRef.current=h.goNextMusic}),[]);var f=function(e){h.deleteMusic(e)};return Object(d.jsxs)("div",{className:"side",children:[Object(d.jsx)("label",{children:"\uc720\ud29c\ube0c api \ud0a4"}),Object(d.jsx)("input",{type:"text",onChange:function(e){window.youtubeKey=e.target.value,localStorage.setItem("youtubeKey",e.target.value)},value:localStorage.getItem("youtubeKey")}),Object(d.jsx)("textarea",{value:s,onChange:function(e){r(e.target.value)}}),Object(d.jsx)("button",{onClick:function(){if(""!==s){var e=s.split("\n").filter((function(e){return""!==e}));e.length<1||(h.appendMusicList(e),r(""))}},children:"append"}),Object(d.jsx)("button",{onClick:h.goPrevMusic,children:"\uc774\uc804 "})," ",Object(d.jsx)("button",{onClick:h.goNextMusic,children:"\ub2e4\uc74c "}),Object(d.jsx)(k.a,{onDragEnd:function(e){e.destination&&h.reorderMusicList(e.source.index,e.destination.index)},onDragStart:function(e){},children:Object(d.jsx)(k.c,{droppableId:"droppable",children:function(e,t){return Object(d.jsxs)("ul",{ref:e.innerRef,children:[o.map((function(e,t){return Object(d.jsx)(A,{ele:e,index:t,selectMusic:h.selectMusic,deleteMusic:f,modMusicList:h.modMusicList,isCurMusic:l==t},e.key)})),e.placeholder]})}})})]})}var T=Object(n.memo)(D);var J=function(){var e=Object(n.useState)(!1),t=Object(a.a)(e,2),i=t[0],s=t[1],r=Object(n.useRef)();return Object(n.useEffect)((function(){if(!window.YT){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t),window.player=null,window.onYouTubeIframeAPIReady=function(){window.player=new window.YT.Player("player",{height:"480",width:"640",events:{onStateChange:function(e){0===e.data&&r.current()},onReady:function(){return s(!0)}}})}}}),[]),Object(d.jsxs)("div",{className:"App",children:[Object(d.jsx)("div",{className:"playerwrapper",id:"player"}),!i&&Object(d.jsx)(l,{}),i&&Object(d.jsxs)("main",{children:[Object(d.jsx)(T,{goNextRef:r}),Object(d.jsx)(I,{children:" "})]})]})};c.a.render(Object(d.jsx)(s.a.StrictMode,{children:Object(d.jsx)(w.a,{children:Object(d.jsx)(J,{})})}),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.78abf7b7.chunk.js.map